---
title: 分布式会话
tags:
  - 分布式会话
  - redis
index_img: https://s3.uuu.ovh/imgs/2022/12/09/7a3d1eb6b907fd06.jpg
categories:
  - 后端
  - 分布式会话
---

## 1. 分布式会话

### 1.1 什么是会话？

会话 session 代表的是客户端与服务器的一次交互过程，这个过程可以是连续的也可以是时断时续的.曾经的 Servlet 时代（jsp），一旦用户与服务端交互，tomcat 服务器就会为用户创建一个 session，同时前端会有一个 jsessionid，每次交互都会携带。如此一来, 服务器只要在接收到用户请求的时候，就可以拿到 jsessionid，并根据这个 id 在内存中找到对应的会话 session，当拿到 session 会话后，那么我们就可以操作会话了。会话存活期间，我们就能认为用户一直处于正在使用着网站的状态，一旦 session 超期过时，那么就可以认为用户已经离开网站，停止交互了。用户的身份信息，我们也是通过 session 来判断的，在 session 中可以保存不同用户的信息。

session 的使用如下：
```java
    @GetMapping("/setSession")
    public Object setSession(HttpServletRequest request) {
        HttpSession session = request.getSession();
        session.setAttribute("userInfo", "new user");
        session.setMaxInactiveInterval(3600);
        session.getAttribute("userInfo");
        return "ok";
    }
```
### 1.2 无状态会话

HTTP 请求是无状态的，用户向服务端发起多次请求，服务端并不会知道这么多次请求都来自同一个用户，这个就是无状态的。

cookie 的出现就是为了有状态的记录用户。

常见的，ios 与服务端交互，安卓与服务端交互，前后端分离，小程序端与服务端交互，它们都是通过发起 http 请求来调用接口数据的，每次交互服务端都不会拿到客户端的状态，但我们可以通过手段去处理，比如用户每次发起请求的时候携带一个 userid 或 user-token，如此一来，就能让服务端根据 userid 或 token 来获得相应的数据。每个用户的下一次请求都能被服务器识别为同一个用户。

### 1.3 有状态会话

## 2. 拦截器

> 基于分布式会话的权限拦截


## 3. 单点登录

> 二次登录问题

